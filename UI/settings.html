<!DOCTYPE html>
<html>
<head><title>Einstellungen</title></head>
<body class="p-4 bg-white dark:bg-gray-800 text-black dark:text-white">
<h2>Einstellungen</h2>

<!-- Auf Anweisung wurde Username und Password hardcoded
<div>
    <input type="text" id="username" maxlength="15" placeholder="Benutzername" /><br />
    <input type="text" id="password" maxlength="15" placeholder="Passwort" /><br />
</div>
-->
<label>
    <input type="checkbox" id="darkModeToggle" /> Dark Mode aktivieren
</label>
<br>
<h2>Kamera-IP-Adressen</h2>
<div id="ipInputs">
    <input type="text" class="ip-field" maxlength="15" onkeypress='return event.charCode >= 48 && event.charCode <= 57 || event.charCode === 46' placeholder="IP Adresse 1" /><br />
    <input type="text" class="ip-field" maxlength="15" onkeypress='return event.charCode >= 48 && event.charCode <= 57 || event.charCode === 46' placeholder="IP Adresse 2" /><br />
    <input type="text" class="ip-field" maxlength="15" onkeypress='return event.charCode >= 48 && event.charCode <= 57 || event.charCode === 46' placeholder="IP Adresse 3" /><br />
    <input type="text" class="ip-field" maxlength="15" onkeypress='return event.charCode >= 48 && event.charCode <= 57 || event.charCode === 46' placeholder="IP Adresse 4" /><br />
</div>
<button id="saveIPs">Speichern</button>
<br>
<button onclick="window.close()">Schließen</button>

<script>

    window.addEventListener("DOMContentLoaded", async () => {
        const settings = await window.electronAPI.getSettings();

        // Dark Mode Zustand setzen
        const darkModetoggle = document.getElementById("darkModeToggle");
        darkModetoggle.checked = settings.darkMode;

        // IP-Felder mit gespeicherten IPs befüllen
        const savedIPs = settings.cameraIPs || [];
        const ipFields = document.querySelectorAll(".ip-field");
        ipFields.forEach((field, index) => {
            field.value = savedIPs[index] || "";
        });

        // Dark Mode Toggle ändert nur localStorage, kein echtes Speichern
        darkModetoggle.addEventListener("change", () => {
            const draftSettings = {
                darkMode: darkModetoggle.checked,
                cameraIPs: getCurrentIPs()
            };
            localStorage.setItem("electron-settings", JSON.stringify(draftSettings));
        });

        // Speichern-Knopf
        document.getElementById("saveIPs").addEventListener("click", async () => {
            const cameraIPs = getCurrentIPs();
            const newSettings = {
                darkMode: darkModetoggle.checked,
                cameraIPs
            };

            await window.electronAPI.setSettings(newSettings);
            localStorage.setItem("electron-settings", JSON.stringify(newSettings));
            window.close(); // optional
        });
    });

    // Hilfsfunktion
    function getCurrentIPs() {
        return Array.from(document.querySelectorAll(".ip-field"))
            .map(input => input.value.trim())
            .filter(ip => ip);
    }

    //Settings Speichern button
    document.getElementById("saveIPs").addEventListener("click", () => {
        const settings = {
            darkMode: document.getElementById("darkModeToggle").checked,
            cameraIPs: getCurrentIPs()
        };
        window.electronAPI.setSettings(settings);
        localStorage.setItem("electron-settings", JSON.stringify(settings));
    });

</script>
</body>
</html>
